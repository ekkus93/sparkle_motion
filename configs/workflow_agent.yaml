# Canonical WorkflowAgent definition (draft)
# Stages: script_stage -> production_stage (orchestrates images/videos/TTS/etc.) -> qa_stage
# Only the `script_stage` and `production_stage` entries are true ADK agents. The
# final `qa_stage` references the `qa_qwen2vl` FunctionTool directly until QA logic is fully
# embedded inside `production_agent`.
# This file is a draft and intended for local dry-run validation.

name: sparkle-motion/workflow/movie_pipeline
version: 0.1.0
description: >-
  Canonical WorkflowAgent encoding the stage graph for the Sparkle Motion
  movie pipeline. Use `scripts/register_workflow.py --dry-run` to validate
  locally against `configs/tool_registry.yaml` and `configs/schema_artifacts.yaml`.

stages:
  - id: script_stage
    tool_id: script_agent:local-colab
    input_schema: configs/schema_artifacts.yaml#/schemas/movie_plan
    output_schema: configs/schema_artifacts.yaml#/schemas/movie_plan
    retry:
      attempts: 3
      backoff_seconds: 2
      max_backoff_seconds: 30
      jitter: true

  - id: production_stage
    tool_id: production_agent:local-colab
    input_schema: configs/schema_artifacts.yaml#/schemas/movie_plan
    output_schema: configs/schema_artifacts.yaml#/schemas/asset_refs
    retry:
      attempts: 2
      backoff_seconds: 4
      max_backoff_seconds: 60
      jitter: true

  - id: qa_stage
    tool_id: qa_qwen2vl:local-colab  # FunctionTool entrypoint, not an ADK agent
    input_schema: configs/schema_artifacts.yaml#/schemas/asset_refs
    output_schema: configs/schema_artifacts.yaml#/schemas/qa_report
    retry:
      attempts: 1
      backoff_seconds: 1
      max_backoff_seconds: 10
      jitter: false

defaults:
  timeout_seconds: 600
  max_concurrent_stages: 2
